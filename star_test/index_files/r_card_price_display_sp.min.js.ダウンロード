/*
 r_card_price_display_sp.js
 Copyright (c) 2016 Rakuten.Inc
 Date : 2017-08-03 19:21:21
*/
Rmodules&&"function"==typeof Rmodules.define&&Rmodules.define(["jQuery","R^1","R.api^1"],function(t,i){"use strict";var a=function(){this.$root=t(".rCardPriceDisplay"),this.btnTemplateSelector="#rCardPriceBtnTemplate",this.$priceCalculationConfig=t("#priceCalculationConfig"),this.retailPrice=this.getRetailPrice(),this.point=this.$root.attr("data-rCardPoint"),this.insertBtn()};a.prototype={insertBtn:function(){var a=t(this.btnTemplateSelector).html(),e=this.calc(),o="";"0"===this.$priceCalculationConfig.attr("data-free-shipping")&&(o="¢®¡˜Œ¡ Ã"),a=i.applyTemplate(a,{"{{price}}":e,"{{note}}":o}),this.$root.append(a)},getRetailPrice:function(){if(this.$priceCalculationConfig.length)return this.$priceCalculationConfig.attr("data-price")},calc:function(){var t=this.retailPrice-this.point;return t<0&&(t=0),t=i.display.formatNumber(t)}};var e=function(i,a,e,o){this.$window=t(window),this.$html=t("html"),this.$body=t("body"),this.$pageWrapper=t(e),this.modalTemplateSelector=o,this.scrollTop=0,this.$modalHead=void 0,this.$modalContent=void 0,this.$modal=void 0,this.createModal(),this.$btn=t(i),this.$closeBtn=t(a),this.cardClickID=t("#card_click_id").val(),this.events()};e.prototype={createModal:function(){var a=t("<div>"),e=t(this.modalTemplateSelector).html(),o=this.getData(),s={"{{point}}":o.point,"{{retailPrice}}":o.retailPrice,"{{actualPrice}}":o.actualPrice};e=i.applyTemplate(e,s),a.html(e),this.$body.append(a),this.$modalHead=t(".rCardPriceDisplayModal__head"),this.$modalContent=t(".rCardPriceDisplayModal__content"),this.$modal=t(t("#rCardPriceBtn").attr("data-targetModal"))},getData:function(){var a=t("#priceCalculationConfig").attr("data-price"),e={},o=t(".rCardPriceDisplay").attr("data-rCardPoint"),s=a-o;return s<0&&(s=0),e.point=i.display.formatNumber(o),e.retailPrice=i.display.formatNumber(a),e.actualPrice=i.display.formatNumber(s),e},events:function(){this.$window.bind("resize",this.setModalHeight.bind(this)),this.$window.bind("orientationchange",this.setModalHeight.bind(this)),this.$window.bind("hashchange",{that:this},this.hashHandler),this.$btn.bind("click",{that:this},this.open),this.$closeBtn.bind("click",{that:this},this.close)},clickHandler:function(a){var e=a.data.that;e.$modal=t(t(this).attr("data-targetModal")),e.$modal.hasClass("is-open")?e.close():e.open(),e.$html.toggleClass("is-fixedHeight"),e.$body.toggleClass("is-fixedHeight"),i.sendToSc({prop18:e.cardClickID})},open:function(t){var a=t.data.that;a.scrollTop=a.$window.scrollTop(),a.setModalHeight(),a.$pageWrapper.css({marginTop:a.$window.scrollTop()*-1+"px"}),a.$modal.addClass("is-open"),setTimeout(function(){a.$modal.find("> div").addClass("is-open")},100),location.hash="r_card_modal",a.$html.addClass("is-fixedHeight"),a.$body.addClass("is-fixedHeight"),i.sendToSc({prop18:a.cardClickID})},close:function(t){var a=t.data.that;a.$pageWrapper.css({marginTop:0}),setTimeout(function(){a.$window.scrollTop(a.scrollTop)},0),a.$modal.find("> div").removeClass("is-open"),setTimeout(function(){a.$modal.removeClass("is-open")},300),location.hash="",a.$html.removeClass("is-fixedHeight"),a.$body.removeClass("is-fixedHeight"),i.sendToSc({prop18:a.cardClickID})},setModalHeight:function(){this.$modalContent.css({height:this.$window.height()-this.$modalHead.height()+"px"})},hashHandler:function(t){var i=t.data.that;location.hash.length<1&&i.$modal.hasClass("is-open")&&i.$closeBtn.trigger("click")}},new a,new e(".rCardPriceDisplay__btn",".rCardPriceDisplayModal__close","article.current","#rCardPricePopupTemplate")});
