/*
 * shisa-1.0.2
 * Copyright (c) 2017 Rakuten.Inc
 * Date: 2017-06-29 11:00:11
 */
!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var r=void 0;for(r in t)S.call(t,r)&&(e[r]=t[r]);return e}function i(e){var t=new XMLHttpRequest,r=void 0;return"withCredentials"in t||"undefined"==typeof XDomainRequest?(t.open("POST",e),t.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),t):(r=new XDomainRequest,r.open("POST",e),r)}function a(e){return e.replace(/^\s+/g,"")}function s(e){var t=void 0,r=void 0,n=void 0,o=void 0,i=document.cookie&&document.cookie.split(";");if(!i)return null;for(t=0;t<i.length;t++)if(n=i[t],(r=n.indexOf("="))!==-1&&a(window.decodeURIComponent(n.substr(0,r)))===e){try{o=window.decodeURIComponent(n.substr(r+1,n.length-r-1)),o=window.JSON.parse(o)}catch(e){}return o}return null}function c(e){var t=s("Rt"),r=parseInt(t?t.substr(t.length-3):0,16);return e=e.split("-"),r>=parseInt(e[0],16)&&r<=parseInt(e[1],16)}function u(e){try{return e.setItem(y,"1"),e.removeItem(y),!0}catch(e){return!1}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d="1.0.2",p="//rat.rakuten.co.jp/",h="1164",f="1",g="pv",m=132e3,v=604800,w=100,y="__STORAGE_TEST_KEY__",E=5e3,x=.5,b="shisa",T=(new Date).getTime(),O=T+String(Math.random()).substring(1),S=Object.prototype.hasOwnProperty,k=function(){function e(t){n(this,e),this.options=o({maxCachedErrors:w,cacheTime:v,timeLimit:E,sendPercentage:x,url:p},t),(100*Math.random()>this.options.sendPercentage||this.options.sendRange&&!c(this.options.sendRange))&&(this.options.sendData=!1),this.options.regExp&&(this.regExp=new RegExp(this.options.regExp,this.options.regExpFlags)),this.queue=[],this.list=[],this.ignored=[]}return l(e,[{key:"log",value:function(e){var t=this.regExp&&!this.regExp.exec(e.msg)?this.ignored:this.queue;e.timeOffset=(new Date).getTime()-T,t.push(e),this.list.push(e);var r=this;this.options.useTimer&&(clearTimeout(this.timer),this.timer=setTimeout(function(){return r.sendData()},this.options.timeLimit))}},{key:"sendData",value:function(){if(this.options.sendData&&0!==this.queue.length&&this.options.url){var e=i(this.options.url),t="cpkg_none=",r=[],n=void 0;for(n=0;n<this.queue.length;n++){var o=this.queue[n];if(!this.errorIsCached(o)){var a={sessionId:O,shisaVersion:d,start:T,page:window.location.href,group:void 0!==this.options.group?this.options.group:void 0,type:o.type,errorObj:o.error,msg:o.msg,fileUrl:o.fileUrl,lineNumber:o.lineNumber,column:o.column,stack:o.stack},s={acc:h,aid:f,etype:g,cks:null,ckp:null,cp:a};r.push(s)}}if(0===r.length)return void(this.queue=[]);if(t+=JSON.stringify(r),t.length>m){var c={acc:h,aid:f,etype:g,cks:null,ckp:null,cp:{sessionId:O,start:T,apiError:"ERROR: RAT API POST request character limit exceeded. Check url manually."}};t="cpkg_none="+JSON.stringify(c)}try{e.send(t),this.queue=[]}catch(e){}}}},{key:"errorIsCached",value:function(e){if(this.options.cacheErrors&&u(localStorage)){var t=void 0;t=e.fileUrl?window.location.href+"_"+e.lineNumber+"_"+(e.column||""):window.location.href+"_0_0";var r=b+":"+t;if(localStorage.getItem(r))return!0;if(localStorage.length>=this.options.maxCachedErrors){var n=0,o=void 0;for(o in localStorage)S.call(localStorage,o)&&0===o.indexOf(b+":")&&n++;if(n>=this.options.maxCachedErrors)return!1}var i=(new Date).getTime()/1e3|0,a={d:!0,t:i+this.options.cacheTime};try{localStorage.setItem(r,JSON.stringify(a))}catch(e){}}return!1}},{key:"purgeCache",value:function(){if(u(localStorage)){var e=void 0,t=(new Date).getTime()/1e3|0;for(e in localStorage)if(S.call(localStorage,e)&&0===e.indexOf(b+":")){var r=JSON.parse(localStorage.getItem(e));r.t&&t>r.t&&localStorage.removeItem(e)}}}}]),e}();e.exports=k},function(e,t,r){"use strict";function n(e,t){return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var i=t.apply(null,n);return"function"==typeof e&&e.apply(null,n),i}}function o(e){e=e.replace(l,"");for(var t=e.indexOf("-");t!==-1;)e=e.substr(0,t)+e.charAt(t+1).toUpperCase()+e.substr(t+2),t=e.indexOf("-");return e}function i(e){function t(e,t){return void 0!==e?!("false"===e||"0"===e):t}var r=e.attributes,n={},i=void 0,a=void 0;for(i=0;i<r.length;i++)a=r[i],n[o(a.name)]=a.value;return n.sendData=t(n.sendData,!0),n.hideErrors=t(n.hideErrors,!1),n.useTimer=t(n.useTimer,!0),n.cacheErrors=t(n.cacheErrors,!0),n.sendPercentage&&(n.sendPercentage=parseFloat(n.sendPercentage)),n.timeLimit&&(n.timeLimit=parseFloat(n.timeLimit)),n.maxCachedErrors&&(n.maxCachedErrors=parseFloat(n.maxCachedErrors)),n.cacheTime&&(n.cacheTime=parseFloat(n.cacheTime)),n}function a(e){function t(t,r,n,o,i){return r&&n&&0!==n?(e.log({type:"Uncaught Exception",msg:t,fileUrl:r,lineNumber:n,column:o,error:i,stack:void 0!==i?i.stack:void 0}),e.options.hideErrors):(e.log({type:"Uncaught Exception",msg:"There are unknown errors on this page, please check it in browser console"}),e.options.hideErrors)}function r(t){return e.log({type:"Unhandled Rejection",msg:t.reason?t.reason.message:"",error:t.reason}),e.options.hideErrors}function o(t){e.sendData()}window.onbeforeunload=n(window.onbeforeunload,o),window.onerror=n(window.onerror,t),window.onunhandledrejection=n(window.onunhandledrejection,r)}function s(){var e=document.currentScript||document.getElementById(u),t=i(e),r=new c(t);a(r),setTimeout(r.purgeCache,d),t.globalVar&&(window[t.globalVar]=r)}var c=r(0),u="script-shisa",l=/(^data-)/,d=3e4,p=document.documentMode;"undefined"==typeof window||p<9||s()}]);

